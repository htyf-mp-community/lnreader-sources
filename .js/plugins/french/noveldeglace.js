"use strict";var e=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(n,i){function l(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}u((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,r,n,i,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(l=0)),l;)try{if(a=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return l.label++,{value:o[1],done:0};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(n=l.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){l.label=o[1];break}if(6===o[0]&&l.label<n[1]){l.label=n[1],n=o;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(o);break}n[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:1}}([o,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:1});var r=require("cheerio"),n=require("@libs/fetch"),i=require("@libs/novelStatus"),l=require("@libs/filterInputs"),o=require("@libs/defaultCover"),u=a(require("dayjs")),s=function(){function a(){this.id="noveldeglace",this.name="NovelDeGlace",this.icon="src/fr/noveldeglace/icon.png",this.site="https://noveldeglace.com/",this.version="1.0.2",this.fetchImage=n.fetchFile,this.filters={categorie_genre:{type:l.FilterTypes.Picker,label:"Catégorie/Genre",value:"all",options:[{label:"Tous",value:"all"},{label:"═══CATÉGORIES═══",value:"categorie_roman"},{label:"Seinen",value:"c_seinen"},{label:"Shonen",value:"c_shonen"},{label:"Original",value:"c_original"},{label:"Yuri",value:"c_yuri"},{label:"Autre",value:"c_autre"},{label:"Fille",value:"c_fille"},{label:"Roman pour Adulte",value:"c_roman-pour-adulte"},{label:"Xuanhuan",value:"c_xuanhuan"},{label:"Yaoi",value:"c_yaoi"},{label:"═══GENRES═══",value:"genre"},{label:"Action",value:"g_action"},{label:"Aventure",value:"g_aventure"},{label:"Comédie",value:"g_comedie"},{label:"Drame",value:"g_drame"},{label:"Fantastique",value:"g_fantastique"},{label:"Harem",value:"g_harem"},{label:"Psychologique",value:"g_psychologique"},{label:"Romance",value:"g_romance"},{label:"Ecchi",value:"g_ecchi"},{label:"Mature",value:"g_mature"},{label:"Surnaturel",value:"g_surnaturel"},{label:"Vie scolaire",value:"g_vie-scolaire"},{label:"Adulte",value:"g_adulte"},{label:"Tragédie",value:"g_tragedie"},{label:"Arts Martiaux",value:"g_arts-martiaux"},{label:"Pas de harem",value:"g_pas-de-harem"},{label:"Tranche de vie",value:"g_tranche-de-vie"},{label:"Mecha",value:"g_mecha"},{label:"Sci-fi",value:"g_sci-fi"},{label:"Science-Fiction",value:"g_science-fiction"},{label:"Anti-Héros",value:"g_anti-heros"},{label:"Horreur",value:"g_horreur"},{label:"Insectes",value:"g_insectes"},{label:"Mystère",value:"g_mystere"},{label:"Lolicon",value:"g_lolicon"},{label:"Shoujo Ai",value:"g_shoujo-ai"},{label:"Smut",value:"g_smut"},{label:"Xuanhuan",value:"g_xuanhuan"},{label:"Shotacon",value:"g_shotacon"}]}}}return a.prototype.getCheerio=function(a){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(a,{headers:{"Accept-Encoding":"deflate"}})];case 1:return(e=t.sent()).ok?[4,e.text()]:[2,void 0];case 2:return i=t.sent(),[2,(0,r.load)(i)]}}))}))},a.prototype.parseNovels=function(e,t){var a=this,r=[];return e("article").each((function(n,i){var l,o=e(i),u=o.find("h2").text().trim(),s=o.find("img").attr("src");if(l=t?o.find("span.Roman > a").attr("href"):o.find("h2 > a").attr("href")){var c={name:u,path:l.replace(a.site,""),cover:s};r.push(c)}})),r},a.prototype.popularNovels=function(a,r){var n=r.filters,i=r.showLatestNovels;return e(this,void 0,void 0,(function(){var e,r,l;return t(this,(function(t){switch(t.label){case 0:if(e=this.site,i)e+="chapitre";else if(r="all",n&&"string"==typeof n.categorie_genre.value&&(r=n.categorie_genre.value),"all"!=r&&"categorie_roman"!=r&&"genre"!=r)"c"==r[0]?e+="categorie_roman/"+r.substring(2):"g"==r[0]&&(e+="genre/"+r.substring(2));else{if(a>1)return[2,[]];e+="roman"}return e+="/page/"+a,[4,this.getCheerio(e)];case 1:return(l=t.sent())?[2,this.parseNovels(l,i)]:[2,[]]}}))}))},a.prototype.parseNovel=function(a){var r,n;return e(this,void 0,void 0,(function(){var e,l,s,c,v,h,f,p,d,g,b;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a)];case 1:if(!(e=t.sent()))throw new Error("Failed to load page (open in web view)");switch((l={path:a,name:"Untitled"}).name=(null===(n=null===(r=e("div.entry-content > div > strong")[0].nextSibling)||void 0===r?void 0:r.nodeValue)||void 0===n?void 0:n.trim())||"Untitled",l.cover=e(".su-row > div > div > img").attr("src")||o.defaultCover,(s=e("div[data-title=Tomes] >").toArray()).pop(),s.shift(),l.summary=e("div[data-title=Synopsis]").text().trim()+"\n\n"+s.map((function(t){return e(t).text()})).join("\n").trim(),l.author=e("strong:contains('Auteur :')").parent().text().replace("Auteur : ","").trim(),l.artist=e("strong:contains('Illustrateur :')").parent().text().replace("Illustrateur :","").trim(),c=e(".categorie").text().replace("Catégorie :","").trim(),v=e(".genre").text().replace("Genre :","").replace(/, /g,",").trim(),c&&"Autre"!=c&&(l.genres=c),v&&(l.genres=l.genres?l.genres+","+v:v),e("strong:contains('Statut :')").parent().attr("class")){case"type etat0":case"type etat1":l.status=i.NovelStatus.Ongoing;break;case"type etat4":l.status=i.NovelStatus.OnHiatus;break;case"type etat5":l.status=i.NovelStatus.Completed;break;case"type etat6":l.status=i.NovelStatus.Cancelled;break;default:l.status=i.NovelStatus.Unknown}return h=[],f=e("div[data-title=Tomes] > div").last().contents(),p=f.length>1,d="",g=this.site,b={janvier:"January",fevrier:"February",mars:"March",avril:"April",mai:"May",juin:"June",juillet:"July",aout:"August",septembre:"September",octobre:"October",novembre:"November",decembre:"December"},f.each((function(t,a){p&&(d="T."+(t+1)+" "),e(a).find(".chpt").each((function(t,a){var r,n,i,l=e(a),o=d+l.find("a").first().text().trim()||"";if(l.find("i.fa").length){var s=(null===(i=l.find("i").parent().next().html())||void 0===i?void 0:i.split("</a>"))||[];null==s||s.shift();var c=[];null==s||s.forEach((function(e){c.push(e.substring(e.indexOf("(")+1,e.indexOf(")")))}));var v=[];l.find("i").parent().next().find("a").each((function(){v.push(this.attribs.href)})),c.length==v.length&&c.forEach((function(e,a){var r=e;try{var n=e.split(" "),i=n[0],l=n[1],s=n[2];r=(0,u.default)("".concat(i," ").concat(b[l.normalize("NFD").replace(/[\u0300-\u036f]/g,"")]," ").concat(s),"DD MMMM YYYY").format("YYYY-MM-DD")}catch(e){}var c={name:o+" ("+(a+1)+")",releaseTime:r,path:v[a].replace(g,""),chapterNumber:t+(a+1)/1e3};h.push(c)}))}else{var f=(null===(r=l.html())||void 0===r?void 0:r.substring((null===(n=l.html())||void 0===n?void 0:n.indexOf("</a>"))||0))||"",p=(null==f?void 0:f.substring(f.indexOf("(")+1,f.indexOf(")")))||void 0;if(p)try{var m=p.split(" "),_=m[0],y=m[1],w=m[2];p=(0,u.default)("".concat(_," ").concat(b[y.normalize("NFD").replace(/[\u0300-\u036f]/g,"")]," ").concat(w),"DD MMMM YYYY").format("YYYY-MM-DD")}catch(e){}var x=l.find("a").attr("href");if(x){var S={name:o,releaseTime:p,path:x.replace(g,""),chapterNumber:t};h.push(S)}}}))})),l.chapters=h,[2,l]}}))}))},a.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a)];case 1:if(!(e=t.sent()))throw new Error("Failed to load page (open in web view)");return e(".mistape_caption").remove(),[2,e(".chapter-content").html()||e(".entry-content").html()||""]}}))}))},a.prototype.searchNovels=function(a,r){return e(this,void 0,void 0,(function(){var e,n;return t(this,(function(t){switch(t.label){case 0:return 1!==r?[2,[]]:(e=this.site+"roman",[4,this.getCheerio(e)]);case 1:if(!(n=t.sent()))throw new Error("Failed to load page (open in web view)");return[2,this.parseNovels(n,0).filter((function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().includes(a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim())}))]}}))}))},a}();exports.default=new s;