"use strict";var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:0};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,u])}}},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:1});var n=require("cheerio"),i=require("@libs/isAbsoluteUrl"),a=require("@libs/fetch"),o=require("@libs/filterInputs"),s=r(require("dayjs")),u=function(){function r(){this.id="rln.app",this.name="ReadLiteNovel",this.version="1.0.0",this.icon="src/en/readlitenovel/icon.png",this.site="https://rln.app",this.filters={order:{value:"top-rated",label:"Order by",options:[{label:"MOST VIEWED",value:"most-viewed"},{label:"TOP RATED",value:"top-rated"},{label:"BOOKMARKS",value:"subscribers"},{label:"NEW",value:"new"}],type:o.FilterTypes.Picker}}}return r.prototype.parseAgoDate=function(t){var e;if(null==t?void 0:t.includes("ago")){var r=(0,s.default)(new Date),n=(null===(e=t.match(/\d+/))||void 0===e?void 0:e[0])||"",i=parseInt(n,10);return n?((t.includes("hours ago")||t.includes("hour ago"))&&r.subtract(i,"hours"),(t.includes("days ago")||t.includes("day ago"))&&r.subtract(i,"days"),(t.includes("months ago")||t.includes("month ago"))&&r.subtract(i,"months"),(t.includes("years ago")||t.includes("year ago"))&&r.subtract(i,"years"),r.toISOString()):null}return null},r.prototype.popularNovels=function(r,o){var s=o.filters;return t(this,void 0,void 0,(function(){var t,o,u,c,l=this;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"/ranking/").concat(s.order.value,"/").concat(r),[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),u=(0,n.load)(o),c=[],u(".category-items li").each((function(t,e){var r=u(e).find(".category-name a").attr("href");if(r){var n=u(e).find(".category-name a").text().trim(),a=u(e).find(".category-img img").attr("src");a&&!(0,i.isUrlAbsolute)(a)&&(a=l.site+a);var o={path:null==r?void 0:r.replace(l.site,""),name:n,cover:a};c.push(o)}})),[2,c]}}))}))},r.prototype.parseNovel=function(r){return t(this,void 0,void 0,(function(){var t,i,o,s,u=this;return e(this,(function(e){switch(e.label){case 0:return[4,(0,a.fetchApi)(this.site+r)];case 1:return[4,e.sent().text()];case 2:return t=e.sent(),i=(0,n.load)(t),o={path:r,name:i(".novel-title").text()||"Untitled",cover:i(".novels-detail img").attr("src"),summary:i(".empty-box").text().trim(),chapters:[]},i(".novels-detail-right li").each((function(t,e){var r=i(e).find("div:first").text(),n=i(e).find("div:last");switch(r){case"Status:":o.status=n.text();break;case"Genres:":o.genres=n.find("a").map((function(t,e){return i(e).text()})).toArray().join(", ")||n.text();break;case"Author(s):":o.author=n.find("a").map((function(t,e){return i(e).text()})).toArray().join(", ")||n.text();break;case"Translator:":o.artist=n.text()}})),s=[],i(".cm-tabs-content li").each((function(t,e){var r=i(e).find("a").attr("href");if(r){var n=i(e).find("a").text().trim(),a=u.parseAgoDate(i(e).find("svg").attr("data-bs-original-title"));s.push({name:n,path:null==r?void 0:r.replace(u.site,""),releaseTime:a})}})),o.chapters=s,[2,o]}}))}))},r.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:return[4,(0,a.fetchApi)(this.site+r)];case 1:return[4,e.sent().text()];case 2:return t=e.sent(),i=(0,n.load)(t),[2,i("#chapterText").html()||""]}}))}))},r.prototype.searchNovels=function(r,n){return t(this,void 0,void 0,(function(){var t,n,i;return e(this,(function(e){switch(e.label){case 0:return t=this.site+"/search/autocomplete?dataType=json&query=".concat(r),[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().json()];case 2:return n=e.sent(),i=[],n.results.forEach((function(t){return i.push({path:t.link,name:t.original_title,cover:t.image})})),[2,i]}}))}))},r.prototype.fetchImage=function(r){return t(this,void 0,void 0,(function(){return e(this,(function(t){return[2,(0,a.fetchFile)(r)]}))}))},r}();exports.default=new u;