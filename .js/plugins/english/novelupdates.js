"use strict";var e=this&&this.__awaiter||function(e,t,l,a){return new(l||(l=Promise))((function(n,r){function o(e){try{u(a.next(e))}catch(e){r(e)}}function s(e){try{u(a.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(o,s)}u((a=a.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var l,a,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(u){return function(s){if(l)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(l=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:0};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],a=0}finally{l=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:1});var l=require("cheerio"),a=require("@libs/fetch"),n=require("@libs/filterInputs"),r=function(){function r(){this.id="novelupdates",this.name="Novel Updates",this.version="0.5.0",this.icon="src/en/novelupdates/icon.png",this.site="https://www.novelupdates.com/",this.filters={sort:{label:"Sort Results By",value:"sdate",options:[{label:"Last Updated",value:"sdate"},{label:"Rating",value:"srate"},{label:"Rank",value:"srank"},{label:"Reviews",value:"sreview"},{label:"Chapters",value:"srel"},{label:"Title",value:"abc"},{label:"Readers",value:"sread"},{label:"Frequency",value:"sfrel"}],type:n.FilterTypes.Picker},order:{label:"Order",value:"desc",options:[{label:"Descending",value:"desc"},{label:"Ascending",value:"asc"}],type:n.FilterTypes.Picker},storyStatus:{label:"Story Status (Translation)",value:"",options:[{label:"All",value:""},{label:"Completed",value:"2"},{label:"Ongoing",value:"3"},{label:"Hiatus",value:"4"}],type:n.FilterTypes.Picker},language:{label:"Language",value:[],options:[{label:"Chinese",value:"495"},{label:"Filipino",value:"9181"},{label:"Indonesian",value:"9179"},{label:"Japanese",value:"496"},{label:"Khmer",value:"18657"},{label:"Korean",value:"497"},{label:"Malaysian",value:"9183"},{label:"Thai",value:"9954"},{label:"Vietnamese",value:"9177"}],type:n.FilterTypes.CheckboxGroup},novelType:{label:"Novel Type",value:[],options:[{label:"Light Novel",value:"2443"},{label:"Published Novel",value:"26874"},{label:"Web Novel",value:"2444"}],type:n.FilterTypes.CheckboxGroup},genres:{label:"Genres",type:n.FilterTypes.ExcludableCheckboxGroup,value:{include:[],exclude:[]},options:[{label:"Action",value:"8"},{label:"Adult",value:"280"},{label:"Adventure",value:"13"},{label:"Comedy",value:"17"},{label:"Drama",value:"9"},{label:"Ecchi",value:"292"},{label:"Fantasy",value:"5"},{label:"Gender Bender",value:"168"},{label:"Harem",value:"3"},{label:"Historical",value:"330"},{label:"Horror",value:"343"},{label:"Josei",value:"324"},{label:"Martial Arts",value:"14"},{label:"Mature",value:"4"},{label:"Mecha",value:"10"},{label:"Mystery",value:"245"},{label:"Psychoical",value:"486"},{label:"Romance",value:"15"},{label:"School Life",value:"6"},{label:"Sci-fi",value:"11"},{label:"Seinen",value:"18"},{label:"Shoujo",value:"157"},{label:"Shoujo Ai",value:"851"},{label:"Shounen",value:"12"},{label:"Shounen Ai",value:"1692"},{label:"Slice of Life",value:"7"},{label:"Smut",value:"281"},{label:"Sports",value:"1357"},{label:"Supernatural",value:"16"},{label:"Tragedy",value:"132"},{label:"Wuxia",value:"479"},{label:"Xianxia",value:"480"},{label:"Xuanhuan",value:"3954"},{label:"Yaoi",value:"560"},{label:"Yuri",value:"922"}]},genre_operator:{label:"Genre (AND/OR)",value:"and",options:[{label:"AND",value:"and"},{label:"OR",value:"or"}],type:n.FilterTypes.Picker}}}return r.prototype.parseNovels=function(e){var t=this,l=[];return e("div.search_main_box_nu").each((function(a,n){var r=e(n).find("img").attr("src"),o=e(n).find(".search_title > a").text(),s=e(n).find(".search_title > a").attr("href");if(s){var u={name:o,cover:r,path:s.replace(t.site,"")};l.push(u)}})),l},r.prototype.popularNovels=function(n,r){var o,s,u,i,c,v,h=r.showLatestNovels,p=r.filters;return e(this,void 0,void 0,(function(){var e,r,d;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site),p.language.value.length||p.novelType.value.length||(null===(o=p.genres.value.include)||void 0===o?void 0:o.length)||(null===(s=p.genres.value.exclude)||void 0===s?void 0:s.length)||""!==p.storyStatus.value?e+="series-finder/?sf=1":e+=h?"latest-series/?st=1":"series-ranking/?rank=week",p.language.value.length&&(e+="&org="+p.language.value.join(",")),p.novelType.value.length&&(e+="&nt="+p.novelType.value.join(",")),(null===(u=p.genres.value.include)||void 0===u?void 0:u.length)&&(e+="&gi="+p.genres.value.include.join(",")),(null===(i=p.genres.value.exclude)||void 0===i?void 0:i.length)&&(e+="&ge="+p.genres.value.exclude.join(",")),((null===(c=p.genres.value.include)||void 0===c?void 0:c.length)||(null===(v=p.genres.value.exclude)||void 0===v?void 0:v.length))&&(e+="&mgi="+p.genre_operator.value),p.storyStatus.value.length&&(e+="&ss="+p.storyStatus.value),e+="&sort="+p.sort.value,e+="&order="+p.order.value,e+="&pg="+n,[4,(0,a.fetchApi)(e).then((function(e){return e.text()}))];case 1:return r=t.sent(),d=(0,l.load)(r),[2,this.parseNovels(d)]}}))}))},r.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,r,o,s,u,i,c,v,h,p,d,b=this;return t(this,(function(t){switch(t.label){case 0:return e=this.site+n,[4,(0,a.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return r=t.sent(),o=(0,l.load)(r),(s={path:n,name:o(".seriestitlenu").text()||"Untitled",cover:o(".seriesimg > img").attr("src"),author:o("#showauthors").text().trim(),chapters:[]}).genres=o("#seriesgenre").children("a").map((function(e,t){return o(t).text()})).toArray().join(","),s.status=o("#editstatus").text().includes("Ongoing")?"Ongoing":"Completed",u=o("#showtype").text().trim(),i=o("#editdescription").text().trim(),s.summary=i+"\n\nType: ".concat(u),c=[],v=o("input#mypostid").attr("value"),(h=new FormData).append("action","nd_getchapters"),h.append("mygrr","0"),h.append("mypostid",v),p="".concat(this.site,"wp-admin/admin-ajax.php"),[4,(0,a.fetchApi)(p,{method:"POST",body:h}).then((function(e){return e.text()}))];case 3:return d=t.sent(),(o=(0,l.load)(d))("li.sp_li_chp").each((function(e,t){var l=o(t).text().trim(),a="https:"+o(t).find("a").first().next().attr("href");c.push({name:l,path:a.replace(b.site,"")})})),s.chapters=c.reverse(),[2,s]}}))}))},r.prototype.getLocation=function(e){var t=e.match(/^(https?:)\/\/(([^:/?#]*)(?::([0-9]+))?)([/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return t&&"".concat(t[1],"//").concat(t[3])},r.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,r,o,s,u,i,c,v,h,p,d,b,f,m,g,y,w,x,C,L,S;return t(this,(function(t){switch(t.label){case 0:return e="",[4,(0,a.fetchApi)(this.site+n)];case 1:return[4,(r=t.sent()).text()];case 2:return o=t.sent(),s=(0,l.load)(o),u=r.url.toLowerCase().includes("wuxiaworld"),i=r.url.toLowerCase().includes("blogspot"),c=r.url.toLowerCase().includes("tumblr"),v=r.url.toLowerCase().includes("wattpad"),h=r.url.toLowerCase().includes("anotivereads"),p=r.url.toLowerCase().includes("blossomtranslation"),d=r.url.toLowerCase().includes("lightnovelstranslations"),b=r.url.toLowerCase().includes("inoveltranslation"),f=r.url.toLowerCase().includes("travistranslations"),m=s('meta[name="generator"]').attr("content")||s("footer").text(),g=0,m&&(g=m.toLowerCase().includes("wordpress")||m.includes("Site Kit by Google")||s(".powered-by").text().toLowerCase().includes("wordpress")),y=r.url.toLowerCase().includes("rainofsnow"),w=r.url.toLowerCase().includes("webnovel"),x=r.url.toLowerCase().includes("hostednovel"),C=r.url.toLowerCase().includes("scribblehub"),u?(e=s("#chapter-content").html(),[3,16]):[3,3];case 3:return y?(e=s("div.content").html(),[3,16]):[3,4];case 4:return c?(e=s(".post").html(),[3,16]):[3,5];case 5:return i?(s(".post-share-buttons").remove(),e=s(".entry-content").html()||s("#post-body").html(),[3,16]):[3,6];case 6:return x?(e=s(".chapter").html(),[3,16]):[3,7];case 7:return C?(e=s("div.chp_raw").html(),[3,16]):[3,8];case 8:return v?(e=s(".container  pre").html(),[3,16]):[3,9];case 9:return f?(e=s(".reader-content").html(),[3,16]):[3,10];case 10:return d?(e=s(".text_story").html(),[3,16]):[3,11];case 11:return p?(e=s(".manga-child-content").html(),[3,16]):[3,12];case 12:return h?(e=s("#comic").html(),[3,16]):[3,13];case 13:return b?(L="https://api."+r.url.slice(8),[4,(0,a.fetchApi)(L).then((function(e){return e.json()}))]):[3,15];case 14:return S=t.sent(),e=S.content.replace(/\n/g,"<br>"),S.notes&&(e+="<br><hr><br>TL Notes:<br>"+S.notes.replace(/\n/g,"<br>")),[3,16];case 15:g?([".c-ads","#madara-comments","#comments",".content-comments",".sharedaddy",".wp-dark-mode-switcher",".wp-next-post-navi",".wp-block-buttons",".wp-block-columns",".post-cats",".sidebar",".author-avatar",".ezoic-ad"].map((function(e){return s(e).remove()})),e=s(".entry-content").html()||s(".single_post").html()||s(".post-entry").html()||s(".main-content").html()||s("article.post").html()||s(".content").html()||s("#content").html()||s(".page-body").html()||s(".td-page-content").html()):w?(e=s(".cha-words").html())||(e=s("._content").html()):(["nav","header","footer",".hidden"].map((function(e){return s(e).remove()})),e=s("body").html()),t.label=16;case 16:return e&&(e=e.replace(/href="\//g,'href="'.concat(this.getLocation(r.url),"/"))),[2,e]}}))}))},r.prototype.searchNovels=function(n,r){return e(this,void 0,void 0,(function(){var e,o,s;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site,"page/").concat(r,"/?s=").concat(n,"&post_type=seriesplans"),[4,(0,a.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return o=t.sent(),s=(0,l.load)(o),[2,this.parseNovels(s)]}}))}))},r.prototype.fetchImage=function(e){return(0,a.fetchFile)(e)},r}();exports.default=new r;