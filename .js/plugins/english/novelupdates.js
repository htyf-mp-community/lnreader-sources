var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,l){function o(e){try{i(n.next(e))}catch(e){l(e)}}function s(e){try{i(n.throw(e))}catch(e){l(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}i((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,a,l,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function s(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:0};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:1});var r=require("cheerio"),n=require("@libs/fetch"),a=require("@libs/filterInputs"),l=function(){function l(){this.id="novelupdates",this.name="Novel Updates",this.version="0.5.3",this.icon="src/en/novelupdates/icon.png",this.site="https://www.novelupdates.com/",this.filters={sort:{label:"Sort Results By",value:"sdate",options:[{label:"Last Updated",value:"sdate"},{label:"Rating",value:"srate"},{label:"Rank",value:"srank"},{label:"Reviews",value:"sreview"},{label:"Chapters",value:"srel"},{label:"Title",value:"abc"},{label:"Readers",value:"sread"},{label:"Frequency",value:"sfrel"}],type:a.FilterTypes.Picker},order:{label:"Order",value:"desc",options:[{label:"Descending",value:"desc"},{label:"Ascending",value:"asc"}],type:a.FilterTypes.Picker},storyStatus:{label:"Story Status (Translation)",value:"",options:[{label:"All",value:""},{label:"Completed",value:"2"},{label:"Ongoing",value:"3"},{label:"Hiatus",value:"4"}],type:a.FilterTypes.Picker},language:{label:"Language",value:[],options:[{label:"Chinese",value:"495"},{label:"Filipino",value:"9181"},{label:"Indonesian",value:"9179"},{label:"Japanese",value:"496"},{label:"Khmer",value:"18657"},{label:"Korean",value:"497"},{label:"Malaysian",value:"9183"},{label:"Thai",value:"9954"},{label:"Vietnamese",value:"9177"}],type:a.FilterTypes.CheckboxGroup},novelType:{label:"Novel Type",value:[],options:[{label:"Light Novel",value:"2443"},{label:"Published Novel",value:"26874"},{label:"Web Novel",value:"2444"}],type:a.FilterTypes.CheckboxGroup},genres:{label:"Genres",type:a.FilterTypes.ExcludableCheckboxGroup,value:{include:[],exclude:[]},options:[{label:"Action",value:"8"},{label:"Adult",value:"280"},{label:"Adventure",value:"13"},{label:"Comedy",value:"17"},{label:"Drama",value:"9"},{label:"Ecchi",value:"292"},{label:"Fantasy",value:"5"},{label:"Gender Bender",value:"168"},{label:"Harem",value:"3"},{label:"Historical",value:"330"},{label:"Horror",value:"343"},{label:"Josei",value:"324"},{label:"Martial Arts",value:"14"},{label:"Mature",value:"4"},{label:"Mecha",value:"10"},{label:"Mystery",value:"245"},{label:"Psychoical",value:"486"},{label:"Romance",value:"15"},{label:"School Life",value:"6"},{label:"Sci-fi",value:"11"},{label:"Seinen",value:"18"},{label:"Shoujo",value:"157"},{label:"Shoujo Ai",value:"851"},{label:"Shounen",value:"12"},{label:"Shounen Ai",value:"1692"},{label:"Slice of Life",value:"7"},{label:"Smut",value:"281"},{label:"Sports",value:"1357"},{label:"Supernatural",value:"16"},{label:"Tragedy",value:"132"},{label:"Wuxia",value:"479"},{label:"Xianxia",value:"480"},{label:"Xuanhuan",value:"3954"},{label:"Yaoi",value:"560"},{label:"Yuri",value:"922"}]},genre_operator:{label:"Genre (AND/OR)",value:"and",options:[{label:"AND",value:"and"},{label:"OR",value:"or"}],type:a.FilterTypes.Picker}}}return l.prototype.parseNovels=function(e){var t=this,r=[];return e("div.search_main_box_nu").each((function(n,a){var l=e(a).find("img").attr("src"),o=e(a).find(".search_title > a").text(),s=e(a).find(".search_title > a").attr("href");if(s){var i={name:o,cover:l,path:s.replace(t.site,"")};r.push(i)}})),r},l.prototype.popularNovels=function(a,l){return e(this,arguments,void 0,(function(e,a){var l,o,s,i,c,u,h,p,v,b=a.showLatestNovels,d=a.filters;return t(this,(function(t){switch(t.label){case 0:return l="".concat(this.site),d.language.value.length||d.novelType.value.length||(null===(i=d.genres.value.include)||void 0===i?void 0:i.length)||(null===(c=d.genres.value.exclude)||void 0===c?void 0:c.length)||""!==d.storyStatus.value?l+="series-finder/?sf=1":l+=b?"latest-series/?st=1":"series-ranking/?rank=week",d.language.value.length&&(l+="&org="+d.language.value.join(",")),d.novelType.value.length&&(l+="&nt="+d.novelType.value.join(",")),(null===(u=d.genres.value.include)||void 0===u?void 0:u.length)&&(l+="&gi="+d.genres.value.include.join(",")),(null===(h=d.genres.value.exclude)||void 0===h?void 0:h.length)&&(l+="&ge="+d.genres.value.exclude.join(",")),((null===(p=d.genres.value.include)||void 0===p?void 0:p.length)||(null===(v=d.genres.value.exclude)||void 0===v?void 0:v.length))&&(l+="&mgi="+d.genre_operator.value),d.storyStatus.value.length&&(l+="&ss="+d.storyStatus.value),l+="&sort="+d.sort.value,l+="&order="+d.order.value,l+="&pg="+e,[4,(0,n.fetchApi)(l).then((function(e){return e.text()}))];case 1:return o=t.sent(),s=(0,r.load)(o),[2,this.parseNovels(s)]}}))}))},l.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,l,o,s,i,c,u,h,p,v,b,d,f=this;return t(this,(function(t){switch(t.label){case 0:return e=this.site+a,[4,(0,n.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return l=t.sent(),o=(0,r.load)(l),(s={path:a,name:o(".seriestitlenu").text()||"Untitled",cover:o(".wpb_wrapper img").attr("src"),chapters:[]}).author=o("#authtag").map((function(e,t){return o(t).text().trim()})).toArray().join(", "),s.genres=o("#seriesgenre").children("a").map((function(e,t){return o(t).text()})).toArray().join(","),s.status=o("#editstatus").text().includes("Ongoing")?"Ongoing":"Completed",i=o("#showtype").text().trim(),c=o("#editdescription").text().trim(),s.summary=c+"\n\nType: ".concat(i),u=[],h=o("input#mypostid").attr("value"),(p=new FormData).append("action","nd_getchapters"),p.append("mygrr","0"),p.append("mypostid",h),v="".concat(this.site,"wp-admin/admin-ajax.php"),[4,(0,n.fetchApi)(v,{method:"POST",body:p}).then((function(e){return e.text()}))];case 3:return b=t.sent(),o=(0,r.load)(b),d={v:"volume ",c:" chapter ",part:"part ",ss:"SS"},o("li.sp_li_chp").each((function(e,t){var r=o(t).text();for(var n in d)r=r.replace(n,d[n]);r=r.replace(/\b\w/g,(function(e){return e.toUpperCase()})).trim();var a="https:"+o(t).find("a").first().next().attr("href");u.push({name:r,path:a.replace(f.site,"")})})),s.chapters=u.reverse(),[2,s]}}))}))},l.prototype.getLocation=function(e){var t=e.match(/^(https?:)\/\/(([^:/?#]*)(?::([0-9]+))?)([/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return t&&"".concat(t[1],"//").concat(t[3])},l.prototype.getChapterBody=function(a,l,o){return e(this,void 0,void 0,(function(){var e,s,i,c,u,h,p,v,b,d,f,m,g,y,x,w,_,k,C,S,T;return t(this,(function(t){switch(t.label){case 0:switch([],e="",s="",i="",c=["blogspot","wordpress","www"],u=l.find((function(e){return!c.includes(e)})),u){case"anotivereads":return[3,1];case"asuratls":return[3,2];case"hiraethtranslation":return[3,3];case"hostednovel":return[3,4];case"inoveltranslation":return[3,5];case"ko-fi":return[3,7];case"mirilu":return[3,8];case"novelplex":return[3,9];case"novelworldtranslations":return[3,10];case"raeitranslations":return[3,11];case"rainofsnow":return[3,13];case"sacredtexttranslations":return[3,14];case"scribblehub":return[3,15];case"stabbingwithasyringe":return[3,16];case"tinytranslation":return[3,19];case"tumblr":return[3,20];case"wattpad":return[3,21];case"webnovel":return[3,22];case"wuxiaworld":return[3,23];case"zetrotranslation":return[3,24]}return[3,25];case 1:return e=a("#comic-nav-name").first().text(),s=a("#spliced-comic").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 2:return h=a(".post-body div b").first(),e=h.text(),h.remove(),s=a(".post-body").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 3:return e=a("li.active").first().text(),s=a(".text-left").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 4:return e=a("#chapter-title").first().text(),s=a("#chapter-content").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 5:return p="https://api."+o.slice(8),[4,(0,n.fetchApi)(p).then((function(e){return e.json()}))];case 6:return v=t.sent(),e="Chapter "+v.chapter+" | "+v.title,s=v.content.replace(/\n/g,"<br>"),v.notes&&(s+="<br><hr><br>TL Notes:<br>"+v.notes.replace(/\n/g,"<br>")),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 7:return i=null===(T=a('script:contains("shadowDom.innerHTML")').html())||void 0===T?void 0:T.match(/shadowDom\.innerHTML \+= '(<div.*?)';/)[1],[3,25];case 8:return["#jp-post-flair"].map((function(e){return a(e).remove()})),b=a(".entry-content p strong").first(),e=b.text(),b.remove(),s=a(".entry-content").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 9:return[".passingthrough_adreminder"].map((function(e){return a(e).remove()})),e=a(".halChap--jud").first().text(),s=a(".halChap--kontenInner ").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 10:return[".separator",'p[dir="ltr"]'].map((function(e){return a(e).remove()})),e=a(".entry-title").first().text(),s=a(".entry-content p span span").html().replace(/&nbsp;/g,"").replace(/\n/g,"<br>"),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 11:return d=o.split("/"),f="".concat(d[0],"//api.").concat(d[2],"/api/chapters/?id=").concat(d[3],"&num=").concat(d[4]),[4,(0,n.fetchApi)(f).then((function(e){return e.json()}))];case 12:return m=t.sent(),e="Chapter "+m.currentChapter.num,s=(s=m.currentChapter.head+"<br><hr><br>"+m.currentChapter.body+"<br><hr><br>Translator's Note:<br>"+m.currentChapter.note).replace(/\n/g,"<br>"),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 13:return g=a(".bb-item").filter((function(){return"block"===a(this).css("display")})),y=(0,r.load)(g.html()),[".responsivevoice-button",".zoomdesc-cont p img",".zoomdesc-cont p noscript"].map((function(e){return y(e).remove()})),s=y(".zoomdesc-cont").html(),(x=y(".scroller h2").first()).length?(e=x.text(),x.remove(),s=y(".zoomdesc-cont").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s))):s&&(i=s),[3,25];case 14:return[".entry-content blockquote",".entry-content div",".reaction-buttons"].map((function(e){return a(e).remove()})),e=a(".entry-title").first().text(),s=a(".entry-content").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 15:return e=a(".chapter-title").first().text(),s=a("div.chp_raw").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 16:return w=a(".entry-content a").attr("href"),[4,(0,n.fetchApi)(w)];case 17:return[4,t.sent().text()];case 18:return _=t.sent(),k=(0,r.load)(_),[".wp-block-buttons","#jp-post-flair",".wpcnt"].map((function(e){return k(e).remove()})),s=k(".entry-content").html(),(C=k(".entry-content h3").first()).length?(e=C.text(),C.remove(),s=k(".entry-content").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s))):s&&(i=s),[3,25];case 19:return[".content noscript",".google_translate_element",".navigate",".post-views","br"].map((function(e){return a(e).remove()})),e=a(".title-content").first().text(),a(".title-content").first().remove(),s=a(".content").html(),e&&s&&(i="<h2>".concat(e,"</h2>").concat(s)),[3,25];case 20:return i=a(".post").html(),[3,25];case 21:return e=a(".h2").first().text(),s=a(".part-content pre").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 22:return e=a(".cha-tit .pr .dib").first().text(),(s=a(".cha-words").html())||(s=a("._content").html()),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 23:return[".MuiLink-root"].map((function(e){return a(e).remove()})),e=a("h4 span").first().text(),s=a(".chapter-content").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 24:return["hr",'p:contains(" ")'].map((function(e){return a(e).remove()})),s=a(".text-left").html(),(S=a(".text-left h2").first()).length?(e=S.text(),S.remove(),s=a(".text-left").html(),e&&s&&(i="<h2>".concat(e,"</h2><hr><br>").concat(s))):s&&(e=a(".active").first().text(),i="<h2>".concat(e,"</h2><hr><br>").concat(s)),[3,25];case 25:return[2,i]}}))}))},l.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,l,o,s,i,c,u,h,p,v,b,d,f,m,g;return t(this,(function(t){switch(t.label){case 0:return[],e="",l="",o="",[4,(0,n.fetchApi)(this.site+a)];case 1:return[4,(s=t.sent()).text()];case 2:return i=t.sent(),c=s.url.toLowerCase(),u=c.split("/")[2].split("."),h=(0,r.load)(i),p=h('meta[name="google-adsense-platform-domain"]').attr("content"),v=0,p&&(v=p.toLowerCase().includes("blogspot")),b=h("#dcl_comments-js-extra").html()||h('meta[name="generator"]').attr("content")||h("footer").text(),d=0,b&&(d=b.toLowerCase().includes("wordpress")||b.includes("Site Kit by Google")||h(".powered-by").text().toLowerCase().includes("wordpress")),f=["genesistls"],!d&&u.find((function(e){return f.includes(e)}))&&(d=1),m=["anotivereads","asuratls","mirilu","novelworldtranslations","sacredtexttranslations","stabbingwithasyringe","tinytranslation","zetrotranslation"],u.find((function(e){return m.includes(e)}))&&(d=0,v=0),d||v?[3,4]:[4,this.getChapterBody(h,u,c)];case 3:return o=t.sent(),[3,5];case 4:v?([".button-container",".separator"].map((function(e){return h(e).remove()})),e=h(".entry-title").first().text()||h(".post-title").first().text(),l=h(".entry-content").html()||h(".post-body").html(),e&&l&&(o="<h2>".concat(e,"</h2><hr><br>").concat(l))):d&&([".ad",".author-avatar",".chapter-warning",".entry-meta",".ezoic-ad",".mb-center",".patreon-widget",".post-cats",".pre-bar",".sharedaddy",".sidebar",".wp-block-buttons",".wp-block-image",".wp-dark-mode-switcher",".wp-next-post-navi","#jp-post-flair","#textbox"].map((function(e){return h(e).remove()})),e=h(".entry-title").first().text()||h(".entry-title-main").first().text()||h(".chapter__title").first().text()||h(".sp-title").first().text()||h(".title-content").first().text()||h(".wp-block-post-title").first().text()||h(".title_story").first().text()||h(".active").first().text()||h("head title").first().text(),(g=h(".cat-series").first().text()||"")&&(e=g),l=h(".rdminimal").html()||h(".entry-content").html()||h(".chapter__content").html()||h(".prevent-select").html()||h(".text_story").html()||h(".contenta").html()||h(".single_post").html()||h(".post-entry").html()||h(".main-content").html()||h(".content").html()||h(".page-body").html()||h(".td-page-content").html()||h("#content").html()||h("article.post").html(),e&&l&&(o="<h2>".concat(e,"</h2><hr><br>").concat(l))),t.label=5;case 5:return o||(["nav","header","footer",".hidden"].map((function(e){return h(e).remove()})),o=h("body").html()),o&&(o=o.replace(/href="\//g,'href="'.concat(this.getLocation(s.url),"/"))),[2,o]}}))}))},l.prototype.searchNovels=function(a,l){return e(this,void 0,void 0,(function(){var e,l,o,s,i;return t(this,(function(t){switch(t.label){case 0:return e=a.split("*"),l=e.reduce((function(e,t){return e.length>t.length?e:t}),""),a=l.replace(/[‘’]/g,"'").replace(/\s+/g,"+"),o=this.site+"?s="+a+"&post_type=seriesplans",[4,(0,n.fetchApi)(o)];case 1:return[4,t.sent().text()];case 2:return s=t.sent(),i=(0,r.load)(s),[2,this.parseNovels(i)]}}))}))},l.prototype.fetchImage=function(e){return(0,n.fetchFile)(e)},l}();exports.default=new l;