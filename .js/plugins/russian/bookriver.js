"use strict";var e=this&&this.__awaiter||function(e,a,t,l){return new(t||(t=Promise))((function(i,o){function n(e){try{u(l.next(e))}catch(e){o(e)}}function r(e){try{u(l.throw(e))}catch(e){o(e)}}function u(e){var a;e.done?i(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(n,r)}u((l=l.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var t,l,i,o,n={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(r){return function(u){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(n=0)),n;)try{if(t=1,l&&(i=2&r[0]?l.return:r[0]?l.throw||((i=l.return)&&i.call(l),0):l.next)&&!(i=i.call(l,r[1])).done)return i;switch(l=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return n.label++,{value:r[1],done:0};case 5:n.label++,l=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!(i=n.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){n.label=r[1];break}if(6===r[0]&&n.label<i[1]){n.label=i[1],i=r;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(r);break}i[2]&&n.ops.pop(),n.trys.pop();continue}r=a.call(e,n)}catch(e){r=[6,e],l=0}finally{t=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:1}}([r,u])}}},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:1});var l=require("@libs/filterInputs"),i=require("@libs/fetch"),o=require("@libs/novelStatus"),n=require("cheerio"),r=t(require("dayjs")),u=function(){function t(){var e=this;this.id="bookriver",this.name="Bookriver",this.site="https://bookriver.ru",this.version="1.0.0",this.icon="src/ru/bookriver/icon.png",this.fetchImage=i.fetchFile,this.resolveUrl=function(a,t){return e.site+(t?"/book/":"/reader/")+a},this.filters={sort:{label:"Сортировка",value:"bestseller",options:[{label:"Бестселлеры",value:"bestseller"},{label:"Дате добавления",value:"newest"},{label:"Дате обновления",value:"last-update"}],type:l.FilterTypes.Picker},genres:{label:"жанры",value:[],options:[{label:"Альтернативная история",value:"alternativnaya-istoriya"},{label:"Боевая фантастика",value:"boevaya-fantastika"},{label:"Боевое фэнтези",value:"boevoe-fentezi"},{label:"Бытовое фэнтези",value:"bytovoe-fentezi"},{label:"Героическая фантастика",value:"geroicheskaya-fantastika"},{label:"Героическое фэнтези",value:"geroicheskoe-fentezi"},{label:"Городское фэнтези",value:"gorodskoe-fentezi"},{label:"Детектив",value:"detektiv"},{label:"Детективная фантастика",value:"detektivnaya-fantastika"},{label:"Жёсткая эротика",value:"zhyostkaya-erotika"},{label:"Исторический детектив",value:"istoricheskii-detektiv"},{label:"Исторический любовный роман",value:"istoricheskii-lyubovnyi-roman"},{label:"Историческое фэнтези",value:"istoricheskoe-fentezi"},{label:"Киберпанк",value:"kiberpank"},{label:"Классический детектив",value:"klassicheskii-detektiv"},{label:"Короткий любовный роман",value:"korotkii-lyubovnyi-roman"},{label:"Космическая фантастика",value:"kosmicheskaya-fantastika"},{label:"Криминальный детектив",value:"kriminalnyi-detektiv"},{label:"ЛитРПГ",value:"litrpg"},{label:"Любовная фантастика",value:"lyubovnaya-fantastika"},{label:"Любовное фэнтези",value:"lyubovnoe-fentezi"},{label:"Любовный роман",value:"lyubovnyi-roman"},{label:"Мистика",value:"mistika"},{label:"Молодежная проза",value:"molodezhnaya-proza"},{label:"Научная фантастика",value:"nauchnaya-fantastika"},{label:"Остросюжетный любовный роман",value:"ostrosyuzhetnyi-lyubovnyi-roman"},{label:"Политический детектив",value:"politicheskii-detektiv"},{label:"Попаданцы",value:"popadantsy"},{label:"Постапокалипсис",value:"postapokalipsis"},{label:"Приключенческое фэнтези",value:"priklyuchencheskoe-fentezi"},{label:"Романтическая эротика",value:"romanticheskaya-erotika"},{label:"С элементами эротики",value:"s-elementami-erotiki"},{label:"Славянское фэнтези",value:"slavyanskoe-fentezi"},{label:"Современный любовный роман",value:"sovremennyi-lyubovnyi-roman"},{label:"Социальная фантастика",value:"sotsialnaya-fantastika"},{label:"Тёмное фэнтези",value:"temnoe-fentezi"},{label:"Фантастика",value:"fantastika"},{label:"Фэнтези",value:"fentezi"},{label:"Шпионский детектив",value:"shpionskii-detektiv"},{label:"Эпическое фэнтези",value:"epicheskoe-fentezi"},{label:"Эротика",value:"erotika"},{label:"Эротическая фантастика",value:"eroticheskaya-fantastika"},{label:"Эротический фанфик",value:"eroticheskii-fanfik"},{label:"Эротическое фэнтези",value:"eroticheskoe-fentezi"},{label:"Юмористический детектив",value:"yumoristicheskii-detektiv"},{label:"Юмористическое фэнтези",value:"yumoristicheskoe-fentezi"}],type:l.FilterTypes.CheckboxGroup}}}return t.prototype.popularNovels=function(t,l){var o,r,u,s,v,c,h=l.showLatestNovels,p=l.filters;return e(this,void 0,void 0,(function(){var e,l,b,f,d,k;return a(this,(function(a){switch(a.label){case 0:return e=this.site+"/genre?page="+t+"&perPage=24&sortingType=",e+=h?"last-update":(null===(o=null==p?void 0:p.sort)||void 0===o?void 0:o.value)||"bestseller",(null===(u=null===(r=null==p?void 0:p.genres)||void 0===r?void 0:r.value)||void 0===u?void 0:u.length)&&(e+="&g="+p.genres.value.join(",")),[4,(0,i.fetchApi)(e).then((function(e){return e.text()}))];case 1:return l=a.sent(),b=(0,n.load)(l),f=[],(d=b("#__NEXT_DATA__").html())&&(k=JSON.parse(d),null===(c=null===(v=null===(s=k.props.pageProps.state.pagesFilter)||void 0===s?void 0:s.genre)||void 0===v?void 0:v.books)||void 0===c||c.forEach((function(e){return f.push({name:e.name,cover:e.coverImages[0].url,path:e.slug})}))),[2,f]}}))}))},t.prototype.parseNovel=function(t){var l,u,s,v,c;return e(this,void 0,void 0,(function(){var e,h,p,b,f,d,k;return a(this,(function(a){switch(a.label){case 0:return[4,(0,i.fetchApi)(this.resolveUrl(t,1)).then((function(e){return e.text()}))];case 1:return e=a.sent(),h=(0,n.load)(e),p=h("#__NEXT_DATA__").html(),b=JSON.parse(p||"{}"),f=null===(l=b.props.pageProps.state.book)||void 0===l?void 0:l.bookPage,d={path:t,name:(null==f?void 0:f.name)||"",cover:null==f?void 0:f.coverImages[0].url,summary:null==f?void 0:f.annotation,author:null===(u=null==f?void 0:f.author)||void 0===u?void 0:u.name,genres:null===(s=null==f?void 0:f.tags)||void 0===s?void 0:s.map((function(e){return e.name})).join(", "),status:"writing"===(null==f?void 0:f.statusComplete)?o.NovelStatus.Ongoing:o.NovelStatus.Completed},k=[],null===(c=null===(v=null==f?void 0:f.ebook)||void 0===v?void 0:v.chapters)||void 0===c||c.forEach((function(e,a){e.available&&k.push({name:e.name,path:(null==f?void 0:f.slug)+"/"+e.chapterId,releaseTime:(0,r.default)(e.firstPublishedAt||e.createdAt||void 0).format("LLL"),chapterNumber:a+1})})),d.chapters=k,[2,d]}}))}))},t.prototype.parseChapter=function(t){var l,o;return e(this,void 0,void 0,(function(){var e,n;return a(this,(function(a){switch(a.label){case 0:return"https://api.bookriver.ru/api/v1/books/chapter/text/",[4,(0,i.fetchApi)("https://api.bookriver.ru/api/v1/books/chapter/text/"+t.split("/").pop())];case 1:return[4,a.sent().json()];case 2:return e=a.sent(),n=e.data.content||"Конец произведения",(null===(o=null===(l=e.data)||void 0===l?void 0:l.audio)||void 0===o?void 0:o.available)&&(n+="\n"+e.data.audio.url),[2,n]}}))}))},t.prototype.searchNovels=function(t,l){var o,n;return void 0===l&&(l=1),e(this,void 0,void 0,(function(){var e,r,u;return a(this,(function(a){switch(a.label){case 0:return e="https://api.bookriver.ru/api/v1/search/autocomplete?keyword="+t+"&page="+l+"&perPage=10",[4,(0,i.fetchApi)(e)];case 1:return[4,a.sent().json()];case 2:return r=a.sent(),u=[],null===(n=null===(o=r.data)||void 0===o?void 0:o.books)||void 0===n||n.forEach((function(e){return u.push({name:e.name,cover:e.coverImages[0].url,path:e.slug})})),[2,u]}}))}))},t}();exports.default=new u;