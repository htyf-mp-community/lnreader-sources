"use strict";var e=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(l,r){function i(e){try{u(n.next(e))}catch(e){r(e)}}function s(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,n,l,r,i={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(u){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(a=1,n&&(l=2&s[0]?n.return:s[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,s[1])).done)return l;switch(n=0,l&&(s=[2&s[0],l.value]),s[0]){case 0:case 1:l=s;break;case 4:return i.label++,{value:s[1],done:0};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(l=i.trys,(l=l.length>0&&l[l.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!l||s[1]>l[0]&&s[1]<l[3])){i.label=s[1];break}if(6===s[0]&&i.label<l[1]){i.label=l[1],l=s;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(s);break}l[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{a=l=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:1});var a=require("cheerio"),n=require("@libs/fetch"),l=require("@libs/isAbsoluteUrl"),r=require("@libs/novelStatus"),i=require("@libs/filterInputs"),s=function(){function s(){this.id="ln.hako",this.name="Hako",this.icon="src/vi/hakolightnovel/icon.png",this.site="https://ln.hako.vn",this.version="1.0.1",this.filters={alphabet:{type:i.FilterTypes.Picker,value:"",label:"Chữ cái",options:[{label:"Tất cả",value:""},{label:"Khác",value:"khac"},{label:"A",value:"a"},{label:"B",value:"b"},{label:"C",value:"c"},{label:"D",value:"d"},{label:"E",value:"e"},{label:"F",value:"f"},{label:"G",value:"g"},{label:"H",value:"h"},{label:"I",value:"i"},{label:"J",value:"j"},{label:"K",value:"k"},{label:"L",value:"l"},{label:"M",value:"m"},{label:"N",value:"n"},{label:"O",value:"o"},{label:"P",value:"p"},{label:"Q",value:"q"},{label:"R",value:"r"},{label:"S",value:"s"},{label:"T",value:"t"},{label:"U",value:"u"},{label:"V",value:"v"},{label:"W",value:"w"},{label:"X",value:"x"},{label:"Y",value:"y"},{label:"Z",value:"z"}]},type:{type:i.FilterTypes.CheckboxGroup,label:"Phân loại",value:[],options:[{label:"Truyện dịch",value:"truyendich"},{label:"Truyện sáng tác",value:"sangtac"},{label:"Convert",value:"convert"}]},status:{type:i.FilterTypes.CheckboxGroup,label:"Tình trạng",value:[],options:[{label:"Đang tiến hành",value:"dangtienhanh"},{label:"Tạm ngưng",value:"tamngung"},{label:"Đã hoàn thành",value:"hoanthanh"}]},sort:{type:i.FilterTypes.Picker,label:"Sắp xếp",value:"top",options:[{label:"A-Z",value:"tentruyen"},{label:"Z-A",value:"tentruyenza"},{label:"Mới cập nhật",value:"capnhat"},{label:"Truyện mới",value:"truyenmoi"},{label:"Theo dõi",value:"theodoi"},{label:"Top toàn thời gian",value:"top"},{label:"Top tháng",value:"topthang"},{label:"Số từ",value:"sotu"}]}}}return s.prototype.parseNovels=function(e){var t=this,a=[];return e("#mainpart .row .thumb-item-flow").each((function(n,r){var i=e(r).find("div.thumb_attr.series-title > a").attr("href");if(i){var s=e(r).find(".series-title").text().trim(),u=e(r).find(".img-in-ratio").attr("data-bg");u&&!(0,l.isUrlAbsolute)(u)&&(u=t.site+u);var o={name:s,path:i.replace(t.site,""),cover:u};a.push(o)}})),a},s.prototype.popularNovels=function(n,l){l.showLatestNovels;var r=l.filters;return e(this,void 0,void 0,(function(){var e,l,i,s,u,o,h,c,v,p;return t(this,(function(t){switch(t.label){case 0:for(e=this.site+"/danh-sach",r.alphabet.value&&(e+="/"+r.alphabet.value),l=new URLSearchParams,i=0,s=r.type.value;i<s.length;i++)u=s[i],l.append(u,"1");for(o=0,h=r.status.value;o<h.length;o++)c=h[o],l.append(c,"1");return l.append("sapxep",r.sort.value),e+="?"+l.toString()+"&page="+n,[4,fetch(e)];case 1:return[4,t.sent().text()];case 2:return v=t.sent(),p=(0,a.load)(v),[2,this.parseNovels(p)]}}))}))},s.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,i,s,u,o;return t(this,(function(t){switch(t.label){case 0:return e={path:n,name:"Không có tiêu đề"},[4,fetch(this.site+n)];case 1:return[4,t.sent().text()];case 2:switch(i=t.sent(),s=(0,a.load)(i),e.name=s(".series-name").text().trim(),u=s(".series-cover > .a6-ratio > div").attr("style")||"",o=u.substring(u.indexOf("http"),u.length-2),e.cover=o?(0,l.isUrlAbsolute)(o)?o:this.site+o:"",e.summary=s(".summary-content").text().trim(),e.genres=s(".series-information > div:nth-child(1)").text().trim().split(/\n[\s\n]*/).join(","),e.author=s(".series-information > div:nth-child(2) > .info-value").text().trim(),e.artist=s(".series-information > div:nth-child(3) > .info-value").text().trim(),e.status=s(".series-information > div:nth-child(4) > .info-value").text().trim(),e.status){case"Đang tiến hành":e.status=r.NovelStatus.Ongoing;break;case"Tạm ngưng":e.status=r.NovelStatus.OnHiatus;break;case"Completed":e.status=r.NovelStatus.Completed;break;default:e.status=r.NovelStatus.Unknown}return e.chapters=[],s(".volume-list").each((function(t,a){var n=s(a).find(".sect-title").text().trim(),l=0,r=1;s(a).find(".list-chapters > li").each((function(t,a){var i,u,o=s(a).find("a").attr("href"),h=s(a).find(".chapter-name").text().trim(),c=Number(null===(i=h.match(/Chương\s*(\d+)/i))||void 0===i?void 0:i[1]);c?(l=c,r=1):(c=l+r/10,r++);var v=s(a).find(".chapter-time").text().split("/").map((function(e){return Number(e)}));o&&(null===(u=e.chapters)||void 0===u||u.push({page:n,path:o,name:h,releaseTime:new Date(v[2],v[1],v[0]).toISOString(),chapterNumber:c}))}))})),[2,e]}}))}))},s.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,l;return t(this,(function(t){switch(t.label){case 0:return[4,fetch(this.site+n)];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),l=(0,a.load)(e),[2,l("#chapter-content").html()||""]}}))}))},s.prototype.searchNovels=function(n,l){return e(this,void 0,void 0,(function(){var e,r,i;return t(this,(function(t){switch(t.label){case 0:return e=this.site+"/tim-kiem?keywords="+n+"&page="+l,[4,fetch(e)];case 1:return[4,t.sent().text()];case 2:return r=t.sent(),i=(0,a.load)(r),[2,this.parseNovels(i)]}}))}))},s.prototype.fetchImage=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return e={Referer:"https://ln.hako.vn"},[4,(0,n.fetchFile)(a,{headers:e})];case 1:return[2,t.sent()]}}))}))},s}();exports.default=new s;